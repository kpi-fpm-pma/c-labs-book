

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Теоретичні відомості &#8212; Основи програмування &lt;br/&gt; мовою С</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://gasperpaul.github.io/c-labs-book/content/lab8/theory.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Контрольні питання" href="questions.html" />
    <link rel="prev" title="Вступ" href="intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://gasperpaul.github.io/c-labs-book/content/lab8/theory.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Теоретичні відомості" />
<meta property="og:description" content="Теоретичні відомості  Потоки й файли  Система уведення-виведення мови С підтримує інтерфейс, що не залежить від використовуваного фізичного пристрою уведення-ви" />
<meta property="og:image"       content="https://gasperpaul.github.io/c-labs-book/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Основи програмування <br/> мовою С</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/intro.html">
   Вступ
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №1
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab1/intro.html">
   Базові типи даних, уведення-виведення, бітові операції, операції зсуву
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №2
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab2/intro.html">
   Одновимірні й двовимірні масиви
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №3
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab3/intro.html">
   Опрацювання символьних даних
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №4
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab4/intro.html">
   Указівники, функції, рекурсія
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №5
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab5/intro.html">
   Типи даних, визначені користувачем
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №6
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab6/intro.html">
   Динамічні масиви
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №7
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../lab7/intro.html">
   Однозв'язні списки
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Лабораторна робота №8
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="reference internal" href="intro.html">
   Робота з бінарними й текстовими файлами
  </a>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Теоретичні відомості
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="questions.html">
     Питання для самоперевірки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="problems.html">
     Завдання
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Додатки
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../outro/appendixA.html">
   Додаток А. Рекомендації зі створення інтерфейсу
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../outro/appendixB.html">
   Додаток Б. Титульний лист лабораторної роботи
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../outro/appendixC.html">
   Додаток В. Приклад програмування бітових операцій і операцій зсуву
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../outro/appendixD.html">
   Додаток Г. Алгоритми сортування та пошуку
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../outro/bibliography.html">
   Рекомендована література
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a href="mailto:vikvikgrom@gmail.com">Громова В.В.</a>, 2020
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/lab8/theory.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/GasperPaul/c-labs-book/master?urlpath=lab/tree/content/lab8/theory.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/GasperPaul/c-labs-book/blob/master/content/lab8/theory.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Потоки й файли
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   Відкриття та закриття потоку
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Приклад 8.1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   Основні функції для роботи з файлами
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   Робота з текстовими файлами
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Приклад 8.2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Приклад 8.3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Приклад 8.4
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Приклад 8.5
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     Приклад 8.6
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   Робота з бінарними файлами
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     Приклад 8.7
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     Приклад 8.8
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id15">
   Загальні принципи роботи з файлами записів
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     Приклад 8.9
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     Приклад 8.10
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     Приклад 8.11
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>Теоретичні відомості<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>Потоки й файли<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Система уведення-виведення мови С підтримує інтерфейс, що не залежить від використовуваного фізичного пристрою уведення-виведення. Іншими словами, мова С підтримує абстрактний рівень між програмістом і фізичним пристроєм. Цю абстракцію називають <em>потік</em>. Незважаючи на те, що пристрої можуть бути різні (термінал, дисководи тощо), стандарт ANSI мови С пов’язує кожний із пристроїв із <em>логічним пристроєм</em> — потоком. Оскільки потоки не залежать від фізичних пристроїв, одна й та сама функція може як записувати інформацію на диск, так і виводити її на екран, принтер.</p>
<p>Спосіб зберігання інформації на фізичному пристрої називають <em>файл</em>. Із погляду програміста, під файлом розуміють деяку пойменовану сукупність даних, яка перебуває на зовнішньому пристрої та має певні атрибути (характеристики). Файл — це такий самий об’єкт програми, як і будь-який інший, але різниця полягає в тому, що дані файлу знаходяться не в оперативній пам’яті, а поза нею. Таким чином, файл є довготривалим «сховищем» даних поза програмою.</p>
<p>Кожний потік, пов’язаний із файлом, має керуючу структуру, яку називають <code class="docutils literal notranslate"><span class="pre">FILE</span></code>. Її описано в заголовковому файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>.</p>
<p>Мова С допускає файли двох різновидів:</p>
<ul class="simple">
<li><p><em>текстові</em> (text) — складаються з послідовності символів, розбитих на рядки. Для стандартного поділу на рядки використовують символ «новий рядок», який у файлі подано двома символами <code class="docutils literal notranslate"><span class="pre">'\n'</span></code> (новий рядок) і <code class="docutils literal notranslate"><span class="pre">'\r'</span></code> (повернення каретки). Рядки у файлі є послідовностями непробільних символів. Пробільними, крім символу «пробіл», є також символи <code class="docutils literal notranslate"><span class="pre">'\n'</span></code>, <code class="docutils literal notranslate"><span class="pre">'\r'</span></code>, <code class="docutils literal notranslate"><span class="pre">'\t'</span></code> (горизонтальна табуляція), <code class="docutils literal notranslate"><span class="pre">'\v'</span></code> (вертикальна табуляція), <code class="docutils literal notranslate"><span class="pre">'\f'</span></code> (переведення сторінки). У текстовому файлі зберігають тільки символи, тобто якщо у файлі записано <code class="docutils literal notranslate"><span class="pre">12345</span></code>, то це не ціле число 12345, що займає 4 байти, а 5 символів <code class="docutils literal notranslate"><span class="pre">'1'</span></code>, <code class="docutils literal notranslate"><span class="pre">'2'</span></code>, <code class="docutils literal notranslate"><span class="pre">'3'</span></code>, <code class="docutils literal notranslate"><span class="pre">'4'</span></code>, <code class="docutils literal notranslate"><span class="pre">'5'</span></code>, що разом займають 5 байтів. Під час читання з файлу цю послідовність може бути, звісно, перетворено в число будь-якого з типів <code class="docutils literal notranslate"><span class="pre">double</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">char</span></code>, <code class="docutils literal notranslate"><span class="pre">long</span></code>;</p></li>
<li><p><em>двійкові</em> (binary) — складаються з послідовності байтів, між якими немає розділювачів. Якщо в бінарному файлі трапляється байт із кодом керуючого символу «нового рядка», то він спеціального призначення не має й розглядається так само, як і решта байтів файлу. Якщо в бінарний файл записати від’ємне ціле число <code class="docutils literal notranslate"><span class="pre">-12345</span></code>, то воно запишеться у файл у додатковому коді, у якому в пам’яті комп’ютера подають від’ємні числа. Таке число займатиме 4 байти. Під час читання файлу це число непотрібно перетворювати, як у випадку з текстовим файлом. Якщо ж записати в бінарний файл послідовність символів <code class="docutils literal notranslate"><span class="pre">&quot;-12345&quot;</span></code>, то вона займатиме 6 байтів.</p></li>
</ul>
<p>Послідовність дій з опрацювання файлу стандартизована:</p>
<ol class="simple">
<li><p>Спочатку файл, як і будь-який інший об’єкт програми, потрібно описати.</p></li>
<li><p>Потім файл потрібно відкрити, установивши зв’язок користувацької програми з зовнішнім носієм даних. За допомогою оператора відкриття файлу з ним буде пов’язано відповідний потік. Щойно файл відкрито, між ним і програмою можна передавати інформацію.</p></li>
<li><p>Після цього слідує власне опрацювання файлу — запис у нього даних, сформованих у програмі, читання даних із файлу, низка інших операцій, пов’язаних, наприклад, із пошуком у файлі потрібних даних.</p></li>
<li><p>Завершуючи роботу з файлом, його потрібно закрити. Операція закриття файлу розриває його зв’язок із потоком.</p></li>
</ol>
<p>Якщо потік було відкрито для виведення, то після виконання операції закриття файлу відповідний буфер пам’яті записується на зовнішній пристрій. Якщо програма завершила роботу нормально, то всі файли автоматично закриваються.</p>
<p>Усі операції уведення-виведення реалізують за допомогою функцій бібліотеки мови С. Бібліотека підтримує три рівні уведення-виведення:</p>
<ul class="simple">
<li><p>потокове уведення-виведення;</p></li>
<li><p>уведення-виведення нижнього рівня;</p></li>
<li><p>уведення-виведення для консолі й портів (залежить від ОС). Його було розглянуто в попередніх роботах</p></li>
</ul>
<p>Прототипи функцій уведення-виведення нижнього рівня містяться у файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>. Цими функціями є:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> — читання буфера даних;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> — запис у буфер даних;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fopen()</span></code> — відкриття файлу;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fclose()</span></code> — закриття файлу;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fseek()</span></code> — пошук певного байта у файлі.</p></li>
</ul>
<p>На рівні потокового уведення-виведення обмін даними проводять побайтово. За одне звернення до пристрою (файлу) проводять зчитування або запис фіксованої порції даних (512 або 1024 байти). Можна казати, що потік — це файл разом із наданими засобами буферизації. Обмін із потоком для збільшення швидкості передачі даних проводять, як правило, через спеціальну область оперативної пам’яті — <em>буфер</em>. Буфер накопичує байти, а фактична передача даних виконується після його заповнення. Під час уведення з диску або зчитування з файлу дані поміщають у буфер, а потім побайтово або порціями передають у програму користувача. Це дає можливість виправити помилки, якщо дані з буфера ще не відправлено в програму (рисунок 8.1). Під час виведення у файл дані накопичують у буфері, а у випадку його заповнення записують їх у вигляді єдиного блока на диск. Функції бібліотеки мови С, які підтримують обмін даними на рівні потоку, дають змогу опрацьовувати дані різних розмірів і форматів.</p>
<p><img alt="Схема передачі інформації між потоком, буфером і програмою" src="../../_images/lab81.png" /></p>
<p>Рисунок 8.1 — Схема передачі інформації між потоком, буфером і програмою</p>
<p>Під час роботи з потоком можна:</p>
<ul class="simple">
<li><p>відкривати й закривати потоки (пов’язувати вказівники на потоки з конкретними файлами);</p></li>
<li><p>уводити й виводити рядки, символи, відформатовані дані, порцію даних довільної довжини;</p></li>
<li><p>аналізувати помилки уведення-виведення й досягнення кінця файлу;</p></li>
<li><p>керувати буферизацією потоку й розміром буфера;</p></li>
<li><p>одержувати й установлювати вказівник поточної позиції у файлі.</p></li>
</ul>
<p>Функції бібліотеки уведення-виведення містяться в заголовковому файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>.</p>
</div>
<div class="section" id="id3">
<h2>Відкриття та закриття потоку<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Для початку роботи з потоком його треба відкрити. При цьому потік зв’язується зі структурою типу <code class="docutils literal notranslate"><span class="pre">FILE</span></code>, визначення якої міститься в бібліотековому файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>. У структурі знаходяться вказівник на буфер, указівник на поточну позицію файлу тощо. Після відкриття потоку повертається вказівник на нього, тобто на об’єкт типу <code class="docutils literal notranslate"><span class="pre">FILE</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;;</span><span class="cp"></span>
<span class="c1">//...</span>
<span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;t.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">fopen(&lt;ім’я</span> <span class="pre">файлу&gt;,</span> <span class="pre">&lt;режим</span> <span class="pre">відкриття&gt;)</span></code> — функція для ініціалізації файлу.</p>
<p>Режими відкриття файлу наведено в таблиці 8.1.</p>
<p>Потік можна відкрити в текстовому (<code class="docutils literal notranslate"><span class="pre">t</span></code>) або бінарному (<code class="docutils literal notranslate"><span class="pre">b</span></code>) режимах. За замовчуванням використовують текстовий режим. Явно режим указують у такий спосіб: <code class="docutils literal notranslate"><span class="pre">&quot;r</span> <span class="pre">+</span> <span class="pre">b&quot;</span></code> (або <code class="docutils literal notranslate"><span class="pre">&quot;rb&quot;</span></code>) — бінарний режим для читання.</p>
<p>Таблиця 8.1 – Перелік режимів відкриття файлу</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Режим</p></th>
<th class="text-align:left head"><p>Опис режиму</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">r</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для читання. Якщо файлу не існує, видається помилка під час виконання програми.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">w</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для запису. Якщо файлу не існує, його буде створено, якщо файл існує, уся інформація з нього стирається.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">a</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для додавання. Якщо файлу не існує, його буде створено, якщо файл існує, інформація з нього не стирається, можна виконати запис у кінець файлу.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">r+</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для читання й запису, змінити розмір файлу не можна. Якщо файлу не існує, видається помилка під час виконання програми.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">w+</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для читання й запису. Якщо файлу не існує, його буде створено, якщо файл існує, уся інформація з нього стирається.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">a+</span></code></p></td>
<td class="text-align:left"><p>Файл відкрито для читання й запису. Якщо файлу не існує,  його буде створено, якщо файл існує, інформація з нього не стирається, можна виконати запис у кінець файлу.</p></td>
</tr>
</tbody>
</table>
<p>У файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code> визначено константу <code class="docutils literal notranslate"><span class="pre">EOF</span></code> (від’ємне ціле число), яка є ознакою кінця файлу.</p>
<p>Під час відкриття потоку можуть виникати такі помилки:</p>
<ul class="simple">
<li><p>файл, пов’язаний із потоком, не знайдено (для читання з файлу);</p></li>
<li><p>диск заповнено (під час запису);</p></li>
<li><p>диск захищено від запису (під час запису);</p></li>
<li><p>інше.</p></li>
</ul>
<p>У цих випадках указівник на потік набуває значення <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Для виведення повідомлення про помилку під час відкриття потоку використовують стандартну бібліотекову функцію</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">perror</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<p>з файлу <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>, як показано в наступному прикладі.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-81">посиланням</a>.</p>
</div>
<div class="section" id="id4">
<h3>Приклад 8.1<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;t.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*виводить рядок із повідомленням про помилку*/</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Після роботи з файлом його потрібно закрити за допомогою функції</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>fclose(указівник_на_потік);
</pre></div>
</div>
<p>Коли програма починає виконуватися, автоматично відкриваються декілька потоків, основними з яких є такі:</p>
<ul class="simple">
<li><p>стандартний потік уведення (<code class="docutils literal notranslate"><span class="pre">stdin</span></code>);</p></li>
<li><p>стандартний потік виведення (<code class="docutils literal notranslate"><span class="pre">stdout</span></code>);</p></li>
<li><p>стандартний потік виведення про помилки (<code class="docutils literal notranslate"><span class="pre">stderr</span></code>).</p></li>
</ul>
<p>За замовчуванням потоку <code class="docutils literal notranslate"><span class="pre">stdin</span></code> відповідає клавіатура, а потокам <code class="docutils literal notranslate"><span class="pre">stdout</span></code> і <code class="docutils literal notranslate"><span class="pre">stderr</span></code> — монітор.</p>
<p>Для уведення-виведення за допомогою стандартних потоків використовують такі функції:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getchar()</span></code>, <code class="docutils literal notranslate"><span class="pre">putchar()</span></code> — уведення-виведення окремого символу;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gets()</span></code>, <code class="docutils literal notranslate"><span class="pre">puts()</span></code> — уведення-виведення рядка;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scanf()</span></code>, <code class="docutils literal notranslate"><span class="pre">printf()</span></code> — форматоване уведення-виведення.</p></li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h2>Основні функції для роботи з файлами<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Аналогічно роботі зі стандартними потоками виконують уведення-виведення в потоки, пов’язані з файлами.</p>
<p>Для символьного уведення-виведення використовують такі функції:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fgetc</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">fp</span></code> — указівник на потік, із якого виконують зчитування. Функція повертає з потоку <code class="docutils literal notranslate"><span class="pre">fp</span></code> черговий символ у форматі <code class="docutils literal notranslate"><span class="pre">int</span></code>. Якщо символ неможливо прочитати, повертається значення <code class="docutils literal notranslate"><span class="pre">EOF</span></code>;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fputc</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">fp</span></code> — указівник на потік, у який виконують запис; <code class="docutils literal notranslate"><span class="pre">c</span></code> — змінна типу <code class="docutils literal notranslate"><span class="pre">int</span></code>, у якій міститься символ, який записують у потік. Функція повертає записаний у потік <code class="docutils literal notranslate"><span class="pre">fp</span></code> символ у форматі <code class="docutils literal notranslate"><span class="pre">int</span></code>. Якщо символ неможливо записати, повертається значення <code class="docutils literal notranslate"><span class="pre">EOF</span></code>.</p>
<p>Для порядкóвого уведення-виведення використовують такі функції:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span><span class="o">*</span> <span class="n">fgets</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">char*</span> <span class="pre">s</span></code> — адреса, за якою розміщують зчитувані байти; <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">n</span></code> — кількість зчитуваних байтів; <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, із якого здійснюють зчитування. Приймання байтів закінчується після передачі <code class="docutils literal notranslate"><span class="pre">n-1</span></code> байтів або у випадку одержання керуючого символу <code class="docutils literal notranslate"><span class="pre">'\n'</span></code>, який також передається в приймаючий рядок. У будь-якому випадку рядок закінчується символом <code class="docutils literal notranslate"><span class="pre">'\0'</span></code>. За успішного завершення роботи функція повертає вказівник на прочитаний рядок, неуспішного — 0;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fputs</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">char*</span> <span class="pre">s</span></code> — адреса, із якої беруть байти, що записують у файл; <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, у який виконують запис. При цьому символ кінця рядка (<code class="docutils literal notranslate"><span class="pre">'\0'</span></code>) у файл не записують. За успішного завершення роботи функція повертає невід’ємне число, неуспішного — <code class="docutils literal notranslate"><span class="pre">EOF</span></code>.</p>
<p>Для блокового уведення-виведення використовують такі функції:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fread</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">void*</span> <span class="pre">ptr</span></code> — указівник на область пам’яті, у якій розміщують зчитані з файлу дані; <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">size</span></code> — розмір одного зчитаного елемента; <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">n</span></code> — кількість зчитуваних елементів; <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, із якого здійснюють зчитування. За успішного завершення роботи функція повертає кількість зчитаних елементів, неуспішного — <code class="docutils literal notranslate"><span class="pre">EOF</span></code>;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fwrite</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">void*</span> <span class="pre">ptr</span></code> — указівник на область пам’яті, у якій розміщують дані для запису у файл; <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">size</span></code> — розмір одного записуваного елемента; <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">n</span></code> — кількість записуваних елементів; <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, у який виконують запис. За успішного завершення роботи функція повертає кількість записаних елементів, неуспішного — <code class="docutils literal notranslate"><span class="pre">EOF</span></code>.</p>
<p>Функції <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> і <code class="docutils literal notranslate"><span class="pre">fread()</span></code> зручно використовувати для збереження у файл даних структури.</p>
<p>У деяких випадках інформацію зручно записувати у файл без перетворення, тобто в символьному вигляді, придатному для безпосереднього відображення на екран. Для цього можна використовувати функції форматованого уведення-виведення:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fprintf</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, у який виконують запис; <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char*</span> <span class="pre">fmt</span></code> — форматний рядок; <code class="docutils literal notranslate"><span class="pre">...</span></code> — список змінних, які записують у файл. Функція повертає число записаних символів;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fscanf</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл, із якого здійснюють зчитування; <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char*</span> <span class="pre">fmt</span></code> — форматний рядок; <code class="docutils literal notranslate"><span class="pre">par1,</span> <span class="pre">par2,</span> <span class="pre">...</span></code> — список змінних, у які заноситься інформація з файлу. Функція повертає число змінних, яким присвоєно значення.</p>
<p>Засоби прямого доступу дають можливість переміщувати вказівник поточної позиції в потоці на потрібний байт. Для цього використовують таку функцію:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fseek</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">off</span><span class="p">,</span> <span class="kt">int</span> <span class="n">org</span><span class="p">);</span>
</pre></div>
</div>
<p>де</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FILE*</span> <span class="pre">fp</span></code> — указівник на файл;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">off</span></code> — позиція зміщення;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">org</span></code> — початок відліку.</p></li>
</ul>
<p>Зміщення задають виразом чи змінною. Зміщення може бути від’ємним, тобто можливе переміщення як у прямому, так і у зворотному напрямках. Початок відліку задають однією з визначених у файлі <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code> констант:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SEEK_SET</span> <span class="pre">==</span> <span class="pre">0</span></code> — початок файлу;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SEEK_CUR</span> <span class="pre">==</span> <span class="pre">1</span></code> — поточна позиція;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SEEK_END</span> <span class="pre">==</span> <span class="pre">2</span></code> — кінець файлу.</p></li>
</ul>
<p>Функція <code class="docutils literal notranslate"><span class="pre">fseek()</span></code> повертає 0, якщо переміщення в потоці успішно виконано, інакше вона повертає ненульове значення.
Для роботи з файлами зручно використовувати такі функції:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">ftell(FILE*</span> <span class="pre">fp)</span></code> — повертає поточну позицію у файлі (номер байта);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">feof(FILE*</span> <span class="pre">fp)</span></code> — функція для визначення кінця файлу.</p></li>
</ul>
</div>
<div class="section" id="id6">
<h2>Робота з текстовими файлами<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Перед початком роботи з файлом його потрібно відкрити за допомогою функції <code class="docutils literal notranslate"><span class="pre">fopen()</span></code>, синтаксис якої описано вище. Розгляньмо послідовність дій зі створення простого текстового файлу мовою C та запису в нього текстової інформації.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-82">посиланням</a>.</p>
</div>
<div class="section" id="id7">
<h3>Приклад 8.2<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Рядок для файлу&quot;</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Відбувається запис у файл...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str_file</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">putc</span><span class="p">(</span><span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на запис.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>У прикладі задано вказівник <code class="docutils literal notranslate"><span class="pre">fp</span></code> типу <code class="docutils literal notranslate"><span class="pre">FILE</span></code>, який ініціалізує функція <code class="docutils literal notranslate"><span class="pre">fopen()</span></code>. Функція <code class="docutils literal notranslate"><span class="pre">fopen()</span></code> як перший аргумент приймає рядок, у якому задано шлях до файлу. Другий параметр визначає спосіб опрацювання файлу. У прикладі — це значення <code class="docutils literal notranslate"><span class="pre">&quot;w&quot;</span></code>, яке означає відкриття файлу на запис із видаленням із нього всієї колишньої інформації. Якщо файл відкрито успішно, указівник <code class="docutils literal notranslate"><span class="pre">fp</span></code> не дорівнюватиме <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, і з ним можлива робота. У цьому випадку за допомогою функції <code class="docutils literal notranslate"><span class="pre">putc()</span></code> виконується запис символів у файл, на який указує вказівник <code class="docutils literal notranslate"><span class="pre">fp</span></code>. Перед завершенням програми відкритий файл потрібно закрити, щоб уникнути втрати даних у ньому. Це досягається функцією <code class="docutils literal notranslate"><span class="pre">fclose()</span></code>, яка приймає вказівник на файл і повертає значення 0 за успішного закриття файлу, або <code class="docutils literal notranslate"><span class="pre">EOF</span></code> — за неуспішного.</p>
<p>Розгляньмо тепер приклад програми зчитування інформації з файлу.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-83">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id8">
<h3>Приклад 8.3<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
        <span class="k">while</span><span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
        <span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str_file</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на читання.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>У наведеному лістингу функція <code class="docutils literal notranslate"><span class="pre">fopen()</span></code> відкриває файл на читання, що задає значення другого аргумента — <code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code>. Це означає, що в нього неможливо здійснити запис даних, можливе тільки зчитування. Спочатку виконується цикл <code class="docutils literal notranslate"><span class="pre">while</span></code>, у якому з файлу за допомогою функції <code class="docutils literal notranslate"><span class="pre">getc()</span></code> зчитується символ та виконується перевірка: якщо зчитане значення не дорівнює символу кінця файлу <code class="docutils literal notranslate"><span class="pre">EOF</span></code>, то значення змінної ch записується в масив <code class="docutils literal notranslate"><span class="pre">str_file</span></code>. Цикл виконуватиметься доти, доки з файлу не буде прочитано всі символи, тобто доки не буде досягнуто символу <code class="docutils literal notranslate"><span class="pre">EOF</span></code>. Після завершення циклу формується рядок <code class="docutils literal notranslate"><span class="pre">str_file</span></code>, який виводить на екран функція <code class="docutils literal notranslate"><span class="pre">printf()</span></code>. Перед завершенням програми виконується функція закриття файлу <code class="docutils literal notranslate"><span class="pre">fclose()</span></code>.</p>
<p>Робота з текстовими файлами через функції <code class="docutils literal notranslate"><span class="pre">putc</span></code> і <code class="docutils literal notranslate"><span class="pre">getc</span></code> не завжди зручна. Наприклад, часто потрібно записати або зчитати рядок повністю. Для цього можна скористатися функціями <code class="docutils literal notranslate"><span class="pre">fputs()</span></code> і <code class="docutils literal notranslate"><span class="pre">fgets()</span></code>. Розгляньмо попередні приклади, у яких використано ці функції.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-84">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id9">
<h3>Приклад 8.4<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Рядок для файлу&quot;</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fputs</span><span class="p">(</span><span class="n">str_file</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на запис.&quot;</span><span class="p">);</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">str_file</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">str_file</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str_file</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Аналогічні дії з запису даних у файл і зчитування інформації з нього можна виконати за допомогою функцій <code class="docutils literal notranslate"><span class="pre">fprintf()</span></code> і <code class="docutils literal notranslate"><span class="pre">fscanf()</span></code>, які дають велику гнучкість в опрацюванні даних файлу. Продемонструймо це на прикладі.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-85">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id10">
<h3>Приклад 8.5<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Нехай є структура, яка зберігає таку інформацію про книжки: назва, автор, рік видання. Потрібно написати програму збереження цієї інформації в текстовий файл і її зчитування.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define N 2</span>

<span class="k">struct</span> <span class="n">tag_book</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">author</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">year</span><span class="p">;</span>
<span class="p">}</span> <span class="n">books</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;You entered:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;%s %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">fscanf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;%s %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;----------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Під час виконання цієї програми користувач уводить інформацію про книжки в масив структур <code class="docutils literal notranslate"><span class="pre">books</span></code>. Уведену інформацію виводять на екран. Після цього відкривається на запис файл <code class="docutils literal notranslate"><span class="pre">my_file.txt</span></code>, у який заносять інформацію про книжки в такому порядку: найменування, автор, рік видання. Оскільки число книжок у прикладі дорівнює 2, то вихідний файл міститиме 2 рядки. Після цього файл <code class="docutils literal notranslate"><span class="pre">my_file.txt</span></code> відкривають на читання й за допомогою функції <code class="docutils literal notranslate"><span class="pre">scanf()</span></code> здійснюють зчитування інформації в елементи структури. На завершення зчитану інформацію виводять на екран монітора.</p>
<p>Наведений приклад показує можливість структурованого запису інформації у файл і її зчитування. Це дає змогу відносно просто зберігати різнорідні дані у файлі для їх дальшого використання в програмах.</p>
<p>Уважний розгляд попередніх прикладів дає можливість помітити, що функції зчитування інформації з файлу «знають», із якої позиції варто зчитувати чергову порцію даних. Так, в останньому прикладі функція <code class="docutils literal notranslate"><span class="pre">fscanf()</span></code> «знає», що спочатку потрібно зчитати з файлу перший рядок, потім другий і т.д. Програмісту немає потреби задавати позицію для зчитування даних, усе відбувається автоматично.</p>
<p>Це відбувається тому, що будь-який відкритий файл у програмі мовою С має вказівник позиції, із якої здійснюють зчитування даних. Під час відкриття файлу на читання цей указівник указує на початок файлу. Тому функція <code class="docutils literal notranslate"><span class="pre">fscanf()</span></code>, викликана вперше, зчитує дані першого рядка. По мірі зчитування інформації з файлу позиція зсувається на число зчитаних символів. Функція <code class="docutils literal notranslate"><span class="pre">fscanf()</span></code>, викликана вдруге, працюватиме з другим рядком у файлі.</p>
<p>Незважаючи на те, що вказівник позиції у файлі переміщається автоматично, у мові С можна програмно керувати положенням позиції у файлі за допомогою функцій <code class="docutils literal notranslate"><span class="pre">fseek()</span></code> і <code class="docutils literal notranslate"><span class="pre">ftell()</span></code>, описаних вище. Розгляньмо дію цих функцій на прикладі зчитування символів із файлу у зворотному порядку.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-86">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id11">
<h3>Приклад 8.6<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;Приклад використання функцій fseek and ftell.&quot;</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
        
        <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
        <span class="kt">long</span> <span class="n">length</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
        
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;length = %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="n">putchar</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>У прикладі спочатку створюють файл, у який записують рядок <code class="docutils literal notranslate"><span class="pre">&quot;Приклад</span> <span class="pre">використання</span> <span class="pre">функцій</span> <span class="pre">fseek</span> <span class="pre">and</span> <span class="pre">ftell.&quot;</span></code>. Потім цей файл відкривають на читання, і за допомогою функції <code class="docutils literal notranslate"><span class="pre">fseek(fp,</span> <span class="pre">0L,</span> <span class="pre">SEEK_END)</span></code> указівник позиції переміщують на кінець файлу (за рахунок установлення прапорця <code class="docutils literal notranslate"><span class="pre">SEEK_END</span></code>). У результаті функція <code class="docutils literal notranslate"><span class="pre">ftell(fp)</span></code> поверне число символів у відкритому файлі. Далі функція <code class="docutils literal notranslate"><span class="pre">fseek(fp,</span> <span class="pre">-i,</span> <span class="pre">SEEK_END)</span></code> у циклі зміщує вказівник позиції на <code class="docutils literal notranslate"><span class="pre">-i</span></code> символів відносно кінця файлу, після чого функція <code class="docutils literal notranslate"><span class="pre">getc()</span></code> зчитує символ, який стоїть на <code class="docutils literal notranslate"><span class="pre">i</span></code>-й позиції з кінця. Оскільки змінна i пробігає значення від 1 до <code class="docutils literal notranslate"><span class="pre">length</span></code>, на екран буде виведено символи з файлу у зворотному порядку.</p>
</div>
</div>
<div class="section" id="id12">
<h2>Робота з бінарними файлами<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>В усіх розглянутих вище прикладах функція <code class="docutils literal notranslate"><span class="pre">fopen()</span></code> у режимах <code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code> та <code class="docutils literal notranslate"><span class="pre">&quot;w&quot;</span></code> відкриває текстовий файл на читання й запис, відповідно. Це означає, що деякі символи форматування тексту, наприклад, повернення каретки <code class="docutils literal notranslate"><span class="pre">'\r'</span></code>, не можна зчитати як окремі символи: їх ніби не існує у файлі, хоча насправді вони там є.</p>
<p>Для «тоншої» роботи з умістом файлів існує бінарний режим, який подає вміст файлу як послідовність байтів, у якій керуючі коди є просто числами. У цьому режимі можливе видалення та додавання керуючих символів, недоступне в текстовому режимі. Продемонструймо особливості опрацювання бінарного файлу на прикладі підрахунку у файлі числа керуючих символів повернення каретки <code class="docutils literal notranslate"><span class="pre">'\r'</span></code>.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-87">посиланням</a>.</p>
</div>
<div class="section" id="id13">
<h3>Приклад 8.7<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;Приклад</span><span class="se">\n</span><span class="s"> із</span><span class="se">\n</span><span class="s"> файлом.&quot;</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">||</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Текстовий файл: кількість = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
    
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">||</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Бінарний файл: кількість = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Результат роботи програми такий:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Текстовий</span> <span class="n">файл</span><span class="p">:</span> <span class="n">кількість</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Бінарний</span> <span class="n">файл</span><span class="p">:</span> <span class="n">кількість</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Аналіз одержаного результату свідчить, що під час відкриття файлу в текстовому режимі, функція <code class="docutils literal notranslate"><span class="pre">getc()</span></code> не зчитує символи повернення каретки <code class="docutils literal notranslate"><span class="pre">'\r'</span></code> а в бінарному режимі всі символи доступні.</p>
<p>Ще однією особливістю текстового формату файлу є запис чисел у вигляді тексту. У попередніх прикладах, коли виконувався запис числа у файл за допомогою функції <code class="docutils literal notranslate"><span class="pre">printf()</span></code> (наприклад, року видання книжки), то воно замінювалося на рядок. А коли рядок зчитувався за допомогою функції <code class="docutils literal notranslate"><span class="pre">fscanf()</span></code>, то він перетворювався назад у число.</p>
<p>Для компактного подання інформації у файлі числа доцільно зберігати як числа, а не як рядки. При цьому доречно використовувати бінарний режим доступу до файлу, оскільки в такому випадку будь-яке число сприйматиметься не як керуючий символ, а як число, і буде коректно зчитано з файлу.</p>
<p>Для роботи з бінарними файлами передбачено функції <code class="docutils literal notranslate"><span class="pre">fread()</span></code> і <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>. Розгляньмо приклад їх використання.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-88">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id14">
<h3>Приклад 8.8<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">list</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">numread</span><span class="p">,</span> <span class="n">numwritten</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;fread.out&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="sc">&#39;z&#39;</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">numwritten</span> <span class="o">=</span> <span class="n">fwrite</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">26</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Записано %d значень</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numwritten</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;fread.out&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">numread</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">26</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Прочитано %d значень</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numread</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Уміст буфера: %.26s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    
    <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>У прикладі масив <code class="docutils literal notranslate"><span class="pre">list</span></code> виступає буфером для виведення й уведення інформації з бінарного файлу. Спочатку елементи буфера ініціалізують літерами латинського алфавіту від <code class="docutils literal notranslate"><span class="pre">z</span></code> до <code class="docutils literal notranslate"><span class="pre">a</span></code>, а потім записують у файл за допомогою функції <code class="docutils literal notranslate"><span class="pre">fwrite(list,</span> <span class="pre">sizeof(char),</span> <span class="pre">26,</span> <span class="pre">fp)</span></code>. Тут оператор <code class="docutils literal notranslate"><span class="pre">sizeof(char)</span></code> дає розмір елемента (літери), а число 26 відповідає числу записуваних літер. Аналогічним чином здійснюють зчитування інформації з файлу <code class="docutils literal notranslate"><span class="pre">fread(list,</span> <span class="pre">sizeof(char),</span> <span class="pre">26,</span> <span class="pre">fp)</span></code>, де в масив list поміщаються 26 символів, які зберігають у файлі.</p>
<p>Функція <code class="docutils literal notranslate"><span class="pre">fopen()</span></code> під час відкриття файлу на запис знищує всі дані з нього. Щоб відкрити файл для додавання даних, не знищуючи раніше записаної інформації, третім аргументом функції <code class="docutils literal notranslate"><span class="pre">fopen()</span></code> потрібно задати <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> або <code class="docutils literal notranslate"><span class="pre">&quot;ab&quot;</span></code>, що означає відкрити файл на додавання інформації в його кінець.</p>
<p>Коли стандартні функції повертають <code class="docutils literal notranslate"><span class="pre">EOF</span></code>, як правило це означає, що вони досягли кінця файлу. Проте, це також може означати помилку уведення інформації з файлу. Щоб розрізнити ці дві ситуації, у мові С існують функції <code class="docutils literal notranslate"><span class="pre">feof()</span></code> і <code class="docutils literal notranslate"><span class="pre">ferror()</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">feof()</span></code> повертає значення, відмінне від 0, якщо досягнуто кінець файлу, і 0 — в іншому випадку;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ferror()</span></code> повертає ненульове значення, якщо сталася помилка читання чи запису, і 0 — в іншому випадку.</p></li>
</ul>
</div>
</div>
<div class="section" id="id15">
<h2>Загальні принципи роботи з файлами записів<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Розгляньмо основні принципи роботи з файлами, що містять записи структур деякого типу.</p>
<p>Спочатку потрібно за допомогою відповідної програми створити файл. У програмі повинно бути передбачено функцію додавання запису. Оскільки уведення запису з клавіатури як цілісності неможливо, кожне поле (якщо воно не структуроване) потрібно уводити окремо за запитом або заповнюючи екранну форму. Сформовану структуру записують у файл як цілісність.</p>
<p>Під час читання інформації з файлу читати запис ліпше як цілісність, а потім у програмі аналізувати вміст полів та виконувати потрібні дії.</p>
<p>Для зміни у файлі деякого запису після його прочитання потрібно змістити вказівник файлу на один запис назад, оскільки кожна операція читання-запису зміщує його автоматично. Потім змінені дані можна записувати.
Розгляньмо декілька прикладів роботи з файлами записів.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-89">посиланням</a>.</p>
</div>
<div class="section" id="id16">
<h3>Приклад 8.9<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>Скласти програму, яка виконує такі функції:</p>
<ol class="simple">
<li><p>Створення нового файлу структур із такими полями:</p>
<ul class="simple">
<li><p>назва товару;</p></li>
<li><p>ціна товару;</p></li>
<li><p>кількість товару;</p></li>
<li><p>перегляд файлу.</p></li>
</ul>
</li>
<li><p>Додавання інформації в кінець файлу.</p></li>
<li><p>Пошук даних за назвою товару, зміна ціни й кількості.</p></li>
</ol>
<p>Завдання потрібно виконати в окремих функціях. Для вибору функцій використовувати меню.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">good</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span> <span class="n">t1</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">input</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span> <span class="cm">/*створення нового файлу*/</span>
<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span> <span class="cm">/*перегляд файлу*/</span>
<span class="kt">void</span> <span class="nf">app</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span>   <span class="cm">/*додавання у файл*/</span>
<span class="kt">void</span> <span class="nf">find</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span>  <span class="cm">/*пошук та зміна*/</span>

<span class="kt">void</span> <span class="nf">clrscr</span><span class="p">()</span> <span class="p">{</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;clr||clear&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">flush</span><span class="p">()</span>  <span class="p">{</span> <span class="k">while</span><span class="p">(</span><span class="n">getchar</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">clrscr</span><span class="p">();</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;1 – Новий файл&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;2 – Перегляд файлу&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;3 – Додавання у файл&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;4 – Пошук та зміна&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;0 - Вихід&quot;</span><span class="p">);</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
        
        <span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="sc">&#39;1&#39;</span><span class="o">:</span> <span class="n">input</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;2&#39;</span><span class="o">:</span> <span class="n">print</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;3&#39;</span><span class="o">:</span> <span class="n">app</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;4&#39;</span><span class="o">:</span> <span class="n">find</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;0&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неправильний режим!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">input</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для запису*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Уведення товарів</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Назва: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Ціна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
        
        <span class="cm">/*запис у файл однієї структури t1*/</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Завершити? y/n &quot;</span><span class="p">);</span>
        
        <span class="n">flush</span><span class="p">();</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">getch</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="sc">&#39;y&#39;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="cm">/*відкриття бінарного файлу для читання*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="cm">/*читання з файлу однієї структури t1*/</span>
    <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%3dНазва %10s Ціна %6.2f Кільк. %4d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">flush</span><span class="p">();</span>
    <span class="n">getchar</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">app</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для додавання*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Уведення товарів</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Назва: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Ціна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Завершити? y/n &quot;</span><span class="p">);</span>
        <span class="n">flush</span><span class="p">();</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">getch</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="sc">&#39;y&#39;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">find</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="n">good</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">long</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для читання й запису*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;rb+&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Назва потрібного товару:&quot;</span><span class="p">);</span>
    <span class="n">gets</span><span class="p">(</span><span class="n">good</span><span class="p">);</span>
    <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Назва %10s Ціна %6.2f Кільк. %d&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Змінити? y/n &quot;</span><span class="p">);</span>
            
            <span class="n">flush</span><span class="p">();</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Кількість: &quot;</span><span class="p">);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Ціна: &quot;</span><span class="p">);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
                <span class="n">i</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">);</span>
                <span class="cm">/*повернення на sizeof(t1) байтів назад*/</span>
                <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="cm">/*запис зміненої структури на колишнє місце*/</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-810">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id17">
<h3>Приклад 8.10<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>Програма для корекції існуючого файлу з результатами деякої олімпіади. Відповідна структура містить:</p>
<ul class="simple">
<li><p>поле для назви країни;</p></li>
<li><p>масив із 3 чисел для медалей різного ґатунку.</p></li>
</ul>
<p>У програмі спочатку визначають кількість записів у файлі за допомогою оригінальної функції та виводять результати у вигляді таблиці. Потім користувач може увести назву країни та відкоригувати дані. Якщо такої країни у файлі не знайдено, її додають у кінець файлу. Якщо користувач уведе замість назви країни мінус, процес корекції закінчується.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">clrscr</span><span class="p">()</span> <span class="p">{</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;clr||clear&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">medal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Gold&quot;</span><span class="p">,</span> <span class="s">&quot;Silver&quot;</span><span class="p">,</span> <span class="s">&quot;Bronze&quot;</span><span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">sport</span><span class="p">;</span>

<span class="kt">long</span> <span class="nf">frecount</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">fn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*визначення числа записів*/</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">sport</span> <span class="n">s</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">mdf</span><span class="p">,</span> <span class="n">country</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mf</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">r</span><span class="p">,</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">frecount</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sport</span><span class="p">));</span>
    
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість записів у файлі: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nr</span><span class="p">);</span>
    
    <span class="cm">/*виведення записів у вигляді таблиці*/</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна Золото Срібло Бронза</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    
    <span class="cm">/*корекція й додавання записів*/</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span> <span class="s">&quot;r+b&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">do</span> <span class="p">{</span>
        <span class="cm">/*нескінченний цикл корекції*/</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%15s&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">country</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span> <span class="cm">/*вихід із циклу корекції*/</span> 
        <span class="n">rewind</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
            <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
            <span class="cm">/*цикл пошуку країни у файлі*/</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Нові дані:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">medal</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                    <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">fflush</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">rewind</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="kt">long</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*нова країна – додавання*/</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна: &quot;</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
            <span class="n">strcpy</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Медалі:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">medal</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">getchar</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">getch</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Запустити цей код можна за <a class="reference external" href="https://repl.it/&#64;GasperPaul/Lab8-Example-811">посиланням</a>.</p>
</div>
</div>
<div class="section" id="id18">
<h3>Приклад 8.11<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Програма для організації запису рядка (символьного масиву) у файл блоком, а також читання й виведення на екран записаної інформації.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">msg</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;це тест&quot;</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;DUMMY.FIL&quot;</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Помилка відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/*запис рядка у файл*/</span> 
    <span class="n">fwrite</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="cm">/*установка вказівника на початок файлу*/</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">);</span>
    <span class="cm">/*читання рядка з файлу*/</span>
    <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>У цій програмі потік відкривають у режимі <code class="docutils literal notranslate"><span class="pre">&quot;w+&quot;</span></code> (створення для запису з послідовним читанням). Тому закривати файл під час запису не було потрібно.</p>
<p>У мові С також існують функції <code class="docutils literal notranslate"><span class="pre">remove()</span></code> і <code class="docutils literal notranslate"><span class="pre">rename()</span></code> для видалення й перейменування файлів, відповідно. Їхній синтаксис такий:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">path</span><span class="p">);</span>
</pre></div>
</div>
<p>де <code class="docutils literal notranslate"><span class="pre">*path</span></code> — шлях з іменем файлу, який видаляють.</p>
<p>Цю функцію визначено в бібліотеці <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>, вона повертає 0 за успішного видалення та -1 — у протилежному випадку;</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">rename</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">oldn</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">newn</span><span class="p">);</span>
</pre></div>
</div>
<p>де</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*oldn</span></code> — ім’я файлу для перейменування;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*newn</span></code> — нове ім’я файлу.</p></li>
</ul>
<p>Цю функцію визначено в бібліотеці <code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>, вона повертає 0 за успішного перейменування, та ненульове значення — у протилежному випадку.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/lab8"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">Вступ</a>
    <a class='right-next' id="next-link" href="questions.html" title="next page">Контрольні питання</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Громова В.В.<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            This page was created by <a href="https://github.com/gasperpaul/c-labs-book/graphs/contributors">сommunity</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>