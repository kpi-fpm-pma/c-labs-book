---
interact_link: content/lab8/theory.ipynb
kernel_name: python3
has_widgets: false
title: |-
  Теоретичні відомості
prev_page:
  url: /lab8/intro.html
  title: |-
    Робота з бінарними й текстовими файлами
next_page:
  url: /lab8/questions.html
  title: |-
    Питання для самоперевірки
suffix: .ipynb

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#1058;&#1077;&#1086;&#1088;&#1077;&#1090;&#1080;&#1095;&#1085;&#1110;-&#1074;&#1110;&#1076;&#1086;&#1084;&#1086;&#1089;&#1090;&#1110;">&#1058;&#1077;&#1086;&#1088;&#1077;&#1090;&#1080;&#1095;&#1085;&#1110; &#1074;&#1110;&#1076;&#1086;&#1084;&#1086;&#1089;&#1090;&#1110;<a class="anchor-link" href="#&#1058;&#1077;&#1086;&#1088;&#1077;&#1090;&#1080;&#1095;&#1085;&#1110;-&#1074;&#1110;&#1076;&#1086;&#1084;&#1086;&#1089;&#1090;&#1110;"> </a></h1><h2 id="&#1055;&#1086;&#1090;&#1086;&#1082;&#1080;-&#1081;-&#1092;&#1072;&#1081;&#1083;&#1080;">&#1055;&#1086;&#1090;&#1086;&#1082;&#1080; &#1081; &#1092;&#1072;&#1081;&#1083;&#1080;<a class="anchor-link" href="#&#1055;&#1086;&#1090;&#1086;&#1082;&#1080;-&#1081;-&#1092;&#1072;&#1081;&#1083;&#1080;"> </a></h2><p>Система уведення-виведення мови С підтримує інтерфейс, що не залежить від використовуваного фізичного пристрою уведення-виведення. Іншими словами, мова С підтримує абстрактний рівень між програмістом і фізичним пристроєм. Цю абстракцію називають <em>потік</em>. Незважаючи на те, що пристрої можуть бути різні (термінал, дисководи тощо), стандарт ANSI мови С пов’язує кожний із пристроїв із <em>логічним пристроєм</em> — потоком. Оскільки потоки не залежать від фізичних пристроїв, одна й та сама функція може як записувати інформацію на диск, так і виводити її на екран, принтер.</p>
<p>Спосіб зберігання інформації на фізичному пристрої називають <em>файл</em>. Із погляду програміста, під файлом розуміють деяку пойменовану сукупність даних, яка перебуває на зовнішньому пристрої та має певні атрибути (характеристики). Файл — це такий самий об’єкт програми, як і будь-який інший, але різниця полягає в тому, що дані файлу знаходяться не в оперативній пам’яті, а поза нею. Таким чином, файл є довготривалим «сховищем» даних поза програмою.</p>
<p>Кожний потік, пов’язаний із файлом, має керуючу структуру, яку називають <code>FILE</code>. Її описано в заголовковому файлі <code>stdio.h</code>.</p>
<p>Мова С допускає файли двох різновидів:</p>
<ul>
<li><em>текстові</em> (text) — складаються з послідовності символів, розбитих на рядки. Для стандартного поділу на рядки використовують символ «новий рядок», який у файлі подано двома символами <code>'\n'</code> (новий рядок) і <code>'\r'</code> (повернення каретки). Рядки у файлі є послідовностями непробільних символів. Пробільними, крім символу «пробіл», є також символи <code>'\n'</code>, <code>'\r'</code>, <code>'\t'</code> (горизонтальна табуляція), <code>'\v'</code> (вертикальна табуляція), <code>'\f'</code> (переведення сторінки). У текстовому файлі зберігають тільки символи, тобто якщо у файлі записано <code>12345</code>, то це не ціле число 12345, що займає 4 байти, а 5 символів <code>'1'</code>, <code>'2'</code>, <code>'3'</code>, <code>'4'</code>, <code>'5'</code>, що разом займають 5 байтів. Під час читання з файлу цю послідовність може бути, звісно, перетворено в число будь-якого з типів <code>double</code>, <code>int</code>, <code>char</code>, <code>long</code>;</li>
<li><em>двійкові</em> (binary) — складаються з послідовності байтів, між якими немає розділювачів. Якщо в бінарному файлі трапляється байт із кодом керуючого символу «нового рядка», то він спеціального призначення не має й розглядається так само, як і решта байтів файлу. Якщо в бінарний файл записати від’ємне ціле число <code>-12345</code>, то воно запишеться у файл у додатковому коді, у якому в пам’яті комп’ютера подають від’ємні числа. Таке число займатиме 4 байти. Під час читання файлу це число непотрібно перетворювати, як у випадку з текстовим файлом. Якщо ж записати в бінарний файл послідовність символів <code>"-12345"</code>, то вона займатиме 6 байтів.</li>
</ul>
<p>Послідовність дій з опрацювання файлу стандартизована:</p>
<ol>
<li>Спочатку файл, як і будь-який інший об’єкт програми, потрібно описати.</li>
<li>Потім файл потрібно відкрити, установивши зв’язок користувацької програми з зовнішнім носієм даних. За допомогою оператора відкриття файлу з ним буде пов’язано відповідний потік. Щойно файл відкрито, між ним і програмою можна передавати інформацію.</li>
<li>Після цього слідує власне опрацювання файлу — запис у нього даних, сформованих у програмі, читання даних із файлу, низка інших операцій, пов’язаних, наприклад, із пошуком у файлі потрібних даних.</li>
<li>Завершуючи роботу з файлом, його потрібно закрити. Операція закриття файлу розриває його зв’язок із потоком.</li>
</ol>
<p>Якщо потік було відкрито для виведення, то після виконання операції закриття файлу відповідний буфер пам’яті записується на зовнішній пристрій. Якщо програма завершила роботу нормально, то всі файли автоматично закриваються.</p>
<p>Усі операції уведення-виведення реалізують за допомогою функцій бібліотеки мови С. Бібліотека підтримує три рівні уведення-виведення:</p>
<ul>
<li>потокове уведення-виведення;</li>
<li>уведення-виведення нижнього рівня;</li>
<li>уведення-виведення для консолі й портів (залежить від ОС). Його було розглянуто в попередніх роботах</li>
</ul>
<p>Прототипи функцій уведення-виведення нижнього рівня містяться у файлі <code>stdio.h</code>. Цими функціями є:</p>
<ul>
<li><code>fread()</code> — читання буфера даних;</li>
<li><code>fwrite()</code> — запис у буфер даних;</li>
<li><code>fopen()</code> — відкриття файлу;</li>
<li><code>fclose()</code> — закриття файлу;</li>
<li><code>fseek()</code> — пошук певного байта у файлі.</li>
</ul>
<p>На рівні потокового уведення-виведення обмін даними проводять побайтово. За одне звернення до пристрою (файлу) проводять зчитування або запис фіксованої порції даних (512 або 1024 байти). Можна казати, що потік — це файл разом із наданими засобами буферизації. Обмін із потоком для збільшення швидкості передачі даних проводять, як правило, через спеціальну область оперативної пам’яті — <em>буфер</em>. Буфер накопичує байти, а фактична передача даних виконується після його заповнення. Під час уведення з диску або зчитування з файлу дані поміщають у буфер, а потім побайтово або порціями передають у програму користувача. Це дає можливість виправити помилки, якщо дані з буфера ще не відправлено в програму (рисунок 8.1). Під час виведення у файл дані накопичують у буфері, а у випадку його заповнення записують їх у вигляді єдиного блока на диск. Функції бібліотеки мови С, які підтримують обмін даними на рівні потоку, дають змогу опрацьовувати дані різних розмірів і форматів.</p>
<p><img src="../images/lab81.png" alt="Схема передачі інформації між потоком, буфером і програмою"></p>
<p>Рисунок 8.1 — Схема передачі інформації між потоком, буфером і програмою</p>
<p>Під час роботи з потоком можна:</p>
<ul>
<li>відкривати й закривати потоки (пов’язувати вказівники на потоки з конкретними файлами);</li>
<li>уводити й виводити рядки, символи, відформатовані дані, порцію даних довільної довжини;</li>
<li>аналізувати помилки уведення-виведення й досягнення кінця файлу;</li>
<li>керувати буферизацією потоку й розміром буфера;</li>
<li>одержувати й установлювати вказівник поточної позиції у файлі.</li>
</ul>
<p>Функції бібліотеки уведення-виведення містяться в заголовковому файлі <code>stdio.h</code>.</p>
<h2 id="&#1042;&#1110;&#1076;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103;-&#1090;&#1072;-&#1079;&#1072;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103;-&#1087;&#1086;&#1090;&#1086;&#1082;&#1091;">&#1042;&#1110;&#1076;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103; &#1090;&#1072; &#1079;&#1072;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103; &#1087;&#1086;&#1090;&#1086;&#1082;&#1091;<a class="anchor-link" href="#&#1042;&#1110;&#1076;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103;-&#1090;&#1072;-&#1079;&#1072;&#1082;&#1088;&#1080;&#1090;&#1090;&#1103;-&#1087;&#1086;&#1090;&#1086;&#1082;&#1091;"> </a></h2><p>Для початку роботи з потоком його треба відкрити. При цьому потік зв’язується зі структурою типу <code>FILE</code>, визначення якої міститься в бібліотековому файлі <code>stdio.h</code>. У структурі знаходяться вказівник на буфер, указівник на поточну позицію файлу тощо. Після відкриття потоку повертається вказівник на нього, тобто на об’єкт типу <code>FILE</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;;</span><span class="cp"></span>
<span class="c1">//...</span>
<span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
<span class="c1">//...</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;t.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</pre></div>
<p>де <code>fopen(&lt;ім’я файлу&gt;, &lt;режим відкриття&gt;)</code> — функція для ініціалізації файлу.</p>
<p>Режими відкриття файлу наведено в таблиці 8.1.</p>
<p>Потік можна відкрити в текстовому (<code>t</code>) або бінарному (<code>b</code>) режимах. За замовчуванням використовують текстовий режим. Явно режим указують у такий спосіб: <code>"r + b"</code> (або <code>"rb"</code>) — бінарний режим для читання.</p>
<p>Таблиця 8.1 – Перелік режимів відкриття файлу</p>
<table>
<thead><tr>
<th style="text-align:left">Режим</th>
<th style="text-align:left">Опис режиму</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>r</code></td>
<td style="text-align:left">Файл відкрито для читання. Якщо файлу не існує, видається помилка під час виконання програми.</td>
</tr>
<tr>
<td style="text-align:left"><code>w</code></td>
<td style="text-align:left">Файл відкрито для запису. Якщо файлу не існує, його буде створено, якщо файл існує, уся інформація з нього стирається.</td>
</tr>
<tr>
<td style="text-align:left"><code>a</code></td>
<td style="text-align:left">Файл відкрито для додавання. Якщо файлу не існує, його буде створено, якщо файл існує, інформація з нього не стирається, можна виконати запис у кінець файлу.</td>
</tr>
<tr>
<td style="text-align:left"><code>r+</code></td>
<td style="text-align:left">Файл відкрито для читання й запису, змінити розмір файлу не можна. Якщо файлу не існує, видається помилка під час виконання програми.</td>
</tr>
<tr>
<td style="text-align:left"><code>w+</code></td>
<td style="text-align:left">Файл відкрито для читання й запису. Якщо файлу не існує, його буде створено, якщо файл існує, уся інформація з нього стирається.</td>
</tr>
<tr>
<td style="text-align:left"><code>a+</code></td>
<td style="text-align:left">Файл відкрито для читання й запису. Якщо файлу не існує,  його буде створено, якщо файл існує, інформація з нього не стирається, можна виконати запис у кінець файлу.</td>
</tr>
</tbody>
</table>
<p>У файлі <code>stdio.h</code> визначено константу <code>EOF</code> (від’ємне ціле число), яка є ознакою кінця файлу.</p>
<p>Під час відкриття потоку можуть виникати такі помилки:</p>
<ul>
<li>файл, пов’язаний із потоком, не знайдено (для читання з файлу);</li>
<li>диск заповнено (під час запису);</li>
<li>диск захищено від запису (під час запису);</li>
<li>інше.</li>
</ul>
<p>У цих випадках указівник на потік набуває значення <code>NULL</code>. Для виведення повідомлення про помилку під час відкриття потоку використовують стандартну бібліотекову функцію</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">perror</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">);</span>
</pre></div>
<p>з файлу <code>stdio.h</code>, як показано в наступному прикладі.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-81">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.1">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.1<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.1"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;t.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*виводить рядок із повідомленням про помилку*/</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Після роботи з файлом його потрібно закрити за допомогою функції</p>
<div class="highlight"><pre><span></span><span class="n">fclose</span><span class="p">(</span><span class="err">указівник</span><span class="n">_на_потік</span><span class="p">);</span>
</pre></div>
<p>Коли програма починає виконуватися, автоматично відкриваються декілька потоків, основними з яких є такі:</p>
<ul>
<li>стандартний потік уведення (<code>stdin</code>);</li>
<li>стандартний потік виведення (<code>stdout</code>);</li>
<li>стандартний потік виведення про помилки (<code>stderr</code>).</li>
</ul>
<p>За замовчуванням потоку <code>stdin</code> відповідає клавіатура, а потокам <code>stdout</code> і <code>stderr</code> — монітор.</p>
<p>Для уведення-виведення за допомогою стандартних потоків використовують такі функції:</p>
<ul>
<li><code>getchar()</code>, <code>putchar()</code> — уведення-виведення окремого символу;</li>
<li><code>gets()</code>, <code>puts()</code> — уведення-виведення рядка;</li>
<li><code>scanf()</code>, <code>printf()</code> — форматоване уведення-виведення.</li>
</ul>
<h2 id="&#1054;&#1089;&#1085;&#1086;&#1074;&#1085;&#1110;-&#1092;&#1091;&#1085;&#1082;&#1094;&#1110;&#1111;-&#1076;&#1083;&#1103;-&#1088;&#1086;&#1073;&#1086;&#1090;&#1080;-&#1079;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;">&#1054;&#1089;&#1085;&#1086;&#1074;&#1085;&#1110; &#1092;&#1091;&#1085;&#1082;&#1094;&#1110;&#1111; &#1076;&#1083;&#1103; &#1088;&#1086;&#1073;&#1086;&#1090;&#1080; &#1079; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;<a class="anchor-link" href="#&#1054;&#1089;&#1085;&#1086;&#1074;&#1085;&#1110;-&#1092;&#1091;&#1085;&#1082;&#1094;&#1110;&#1111;-&#1076;&#1083;&#1103;-&#1088;&#1086;&#1073;&#1086;&#1090;&#1080;-&#1079;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;"> </a></h2><p>Аналогічно роботі зі стандартними потоками виконують уведення-виведення в потоки, пов’язані з файлами.</p>
<p>Для символьного уведення-виведення використовують такі функції:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fgetc</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>fp</code> — указівник на потік, із якого виконують зчитування. Функція повертає з потоку <code>fp</code> черговий символ у форматі <code>int</code>. Якщо символ неможливо прочитати, повертається значення <code>EOF</code>;</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fputc</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>fp</code> — указівник на потік, у який виконують запис; <code>c</code> — змінна типу <code>int</code>, у якій міститься символ, який записують у потік. Функція повертає записаний у потік <code>fp</code> символ у форматі <code>int</code>. Якщо символ неможливо записати, повертається значення <code>EOF</code>.</p>
<p>Для порядкóвого уведення-виведення використовують такі функції:</p>
<div class="highlight"><pre><span></span><span class="kt">char</span><span class="o">*</span> <span class="n">fgets</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>char* s</code> — адреса, за якою розміщують зчитувані байти; <code>int n</code> — кількість зчитуваних байтів; <code>FILE* fp</code> — указівник на файл, із якого здійснюють зчитування. Приймання байтів закінчується після передачі <code>n-1</code> байтів або у випадку одержання керуючого символу <code>'\n'</code>, який також передається в приймаючий рядок. У будь-якому випадку рядок закінчується символом <code>'\0'</code>. За успішного завершення роботи функція повертає вказівник на прочитаний рядок, неуспішного — 0;</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fputs</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>char* s</code> — адреса, із якої беруть байти, що записують у файл; <code>FILE* fp</code> — указівник на файл, у який виконують запис. При цьому символ кінця рядка (<code>'\0'</code>) у файл не записують. За успішного завершення роботи функція повертає невід’ємне число, неуспішного — <code>EOF</code>.</p>
<p>Для блокового уведення-виведення використовують такі функції:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fread</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>void* ptr</code> — указівник на область пам’яті, у якій розміщують зчитані з файлу дані; <code>int size</code> — розмір одного зчитаного елемента; <code>int n</code> — кількість зчитуваних елементів; <code>FILE* fp</code> — указівник на файл, із якого здійснюють зчитування. За успішного завершення роботи функція повертає кількість зчитаних елементів, неуспішного — <code>EOF</code>;</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fwrite</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
<p>де <code>void* ptr</code> — указівник на область пам’яті, у якій розміщують дані для запису у файл; <code>int size</code> — розмір одного записуваного елемента; <code>int n</code> — кількість записуваних елементів; <code>FILE* fp</code> — указівник на файл, у який виконують запис. За успішного завершення роботи функція повертає кількість записаних елементів, неуспішного — <code>EOF</code>.</p>
<p>Функції <code>fwrite()</code> і <code>fread()</code> зручно використовувати для збереження у файл даних структури.</p>
<p>У деяких випадках інформацію зручно записувати у файл без перетворення, тобто в символьному вигляді, придатному для безпосереднього відображення на екран. Для цього можна використовувати функції форматованого уведення-виведення:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fprintf</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
<p>де <code>FILE* fp</code> — указівник на файл, у який виконують запис; <code>const char* fmt</code> — форматний рядок; <code>...</code> — список змінних, які записують у файл. Функція повертає число записаних символів;</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">fscanf</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="p">,</span> <span class="p">...)</span>
</pre></div>
<p>де <code>FILE* fp</code> — указівник на файл, із якого здійснюють зчитування; <code>const char* fmt</code> — форматний рядок; <code>par1, par2, ...</code> — список змінних, у які заноситься інформація з файлу. Функція повертає число змінних, яким присвоєно значення.</p>
<p>Засоби прямого доступу дають можливість переміщувати вказівник поточної позиції в потоці на потрібний байт. Для цього використовують таку функцію:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">fseek</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">long</span> <span class="n">off</span><span class="p">,</span> <span class="kt">int</span> <span class="n">org</span><span class="p">);</span>
</pre></div>
<p>де</p>
<ul>
<li><code>FILE* fp</code> — указівник на файл;</li>
<li><code>long off</code> — позиція зміщення;</li>
<li><code>int org</code> — початок відліку.</li>
</ul>
<p>Зміщення задають виразом чи змінною. Зміщення може бути від’ємним, тобто можливе переміщення як у прямому, так і у зворотному напрямках. Початок відліку задають однією з визначених у файлі <code>stdio.h</code> констант:</p>
<ul>
<li><code>SEEK_SET == 0</code> — початок файлу;</li>
<li><code>SEEK_CUR == 1</code> — поточна позиція;</li>
<li><code>SEEK_END == 2</code> — кінець файлу.</li>
</ul>
<p>Функція <code>fseek()</code> повертає 0, якщо переміщення в потоці успішно виконано, інакше вона повертає ненульове значення.
Для роботи з файлами зручно використовувати такі функції:</p>
<ul>
<li><code>long ftell(FILE* fp)</code> — повертає поточну позицію у файлі (номер байта);</li>
<li><code>int feof(FILE* fp)</code> — функція для визначення кінця файлу.</li>
</ul>
<h2 id="&#1056;&#1086;&#1073;&#1086;&#1090;&#1072;-&#1079;-&#1090;&#1077;&#1082;&#1089;&#1090;&#1086;&#1074;&#1080;&#1084;&#1080;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;">&#1056;&#1086;&#1073;&#1086;&#1090;&#1072; &#1079; &#1090;&#1077;&#1082;&#1089;&#1090;&#1086;&#1074;&#1080;&#1084;&#1080; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;<a class="anchor-link" href="#&#1056;&#1086;&#1073;&#1086;&#1090;&#1072;-&#1079;-&#1090;&#1077;&#1082;&#1089;&#1090;&#1086;&#1074;&#1080;&#1084;&#1080;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;"> </a></h2><p>Перед початком роботи з файлом його потрібно відкрити за допомогою функції <code>fopen()</code>, синтаксис якої описано вище. Розгляньмо послідовність дій зі створення простого текстового файлу мовою C та запису в нього текстової інформації.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-82">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.2">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.2<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.2"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Рядок для файлу&quot;</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Відбувається запис у файл...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">str_file</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">putc</span><span class="p">(</span><span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на запис.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>У прикладі задано вказівник <code>fp</code> типу <code>FILE</code>, який ініціалізує функція <code>fopen()</code>. Функція <code>fopen()</code> як перший аргумент приймає рядок, у якому задано шлях до файлу. Другий параметр визначає спосіб опрацювання файлу. У прикладі — це значення <code>"w"</code>, яке означає відкриття файлу на запис із видаленням із нього всієї колишньої інформації. Якщо файл відкрито успішно, указівник <code>fp</code> не дорівнюватиме <code>NULL</code>, і з ним можлива робота. У цьому випадку за допомогою функції <code>putc()</code> виконується запис символів у файл, на який указує вказівник <code>fp</code>. Перед завершенням програми відкритий файл потрібно закрити, щоб уникнути втрати даних у ньому. Це досягається функцією <code>fclose()</code>, яка приймає вказівник на файл і повертає значення 0 за успішного закриття файлу, або <code>EOF</code> — за неуспішного.</p>
<p>Розгляньмо тепер приклад програми зчитування інформації з файлу.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-83">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.3">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.3<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.3"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
        <span class="k">while</span><span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
        <span class="n">str_file</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str_file</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на читання.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>У наведеному лістингу функція <code>fopen()</code> відкриває файл на читання, що задає значення другого аргумента — <code>"r"</code>. Це означає, що в нього неможливо здійснити запис даних, можливе тільки зчитування. Спочатку виконується цикл <code>while</code>, у якому з файлу за допомогою функції <code>getc()</code> зчитується символ та виконується перевірка: якщо зчитане значення не дорівнює символу кінця файлу <code>EOF</code>, то значення змінної ch записується в масив <code>str_file</code>. Цикл виконуватиметься доти, доки з файлу не буде прочитано всі символи, тобто доки не буде досягнуто символу <code>EOF</code>. Після завершення циклу формується рядок <code>str_file</code>, який виводить на екран функція <code>printf()</code>. Перед завершенням програми виконується функція закриття файлу <code>fclose()</code>.</p>
<p>Робота з текстовими файлами через функції <code>putc</code> і <code>getc</code> не завжди зручна. Наприклад, часто потрібно записати або зчитати рядок повністю. Для цього можна скористатися функціями <code>fputs()</code> і <code>fgets()</code>. Розгляньмо попередні приклади, у яких використано ці функції.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-84">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.4">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.4<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.4"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">str_file</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;Рядок для файлу&quot;</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fputs</span><span class="p">(</span><span class="n">str_file</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл на запис.&quot;</span><span class="p">);</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fgets</span><span class="p">(</span><span class="n">str_file</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">str_file</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str_file</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Аналогічні дії з запису даних у файл і зчитування інформації з нього можна виконати за допомогою функцій <code>fprintf()</code> і <code>fscanf()</code>, які дають велику гнучкість в опрацюванні даних файлу. Продемонструймо це на прикладі.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-85">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.5">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.5<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.5"> </a></h4><p>Нехай є структура, яка зберігає таку інформацію про книжки: назва, автор, рік видання. Потрібно написати програму збереження цієї інформації в текстовий файл і її зчитування.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define N 2</span>

<span class="k">struct</span> <span class="n">tag_book</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">author</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">year</span><span class="p">;</span>
<span class="p">}</span> <span class="n">books</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;You entered:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;%s %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">fscanf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;%s %s %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;----------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">author</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">year</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Під час виконання цієї програми користувач уводить інформацію про книжки в масив структур <code>books</code>. Уведену інформацію виводять на екран. Після цього відкривається на запис файл <code>my_file.txt</code>, у який заносять інформацію про книжки в такому порядку: найменування, автор, рік видання. Оскільки число книжок у прикладі дорівнює 2, то вихідний файл міститиме 2 рядки. Після цього файл <code>my_file.txt</code> відкривають на читання й за допомогою функції <code>scanf()</code> здійснюють зчитування інформації в елементи структури. На завершення зчитану інформацію виводять на екран монітора.</p>
<p>Наведений приклад показує можливість структурованого запису інформації у файл і її зчитування. Це дає змогу відносно просто зберігати різнорідні дані у файлі для їх дальшого використання в програмах.</p>
<p>Уважний розгляд попередніх прикладів дає можливість помітити, що функції зчитування інформації з файлу «знають», із якої позиції варто зчитувати чергову порцію даних. Так, в останньому прикладі функція <code>fscanf()</code> «знає», що спочатку потрібно зчитати з файлу перший рядок, потім другий і т.д. Програмісту немає потреби задавати позицію для зчитування даних, усе відбувається автоматично.</p>
<p>Це відбувається тому, що будь-який відкритий файл у програмі мовою С має вказівник позиції, із якої здійснюють зчитування даних. Під час відкриття файлу на читання цей указівник указує на початок файлу. Тому функція <code>fscanf()</code>, викликана вперше, зчитує дані першого рядка. По мірі зчитування інформації з файлу позиція зсувається на число зчитаних символів. Функція <code>fscanf()</code>, викликана вдруге, працюватиме з другим рядком у файлі.</p>
<p>Незважаючи на те, що вказівник позиції у файлі переміщається автоматично, у мові С можна програмно керувати положенням позиції у файлі за допомогою функцій <code>fseek()</code> і <code>ftell()</code>, описаних вище. Розгляньмо дію цих функцій на прикладі зчитування символів із файлу у зворотному порядку.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-86">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.6">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.6<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.6"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;Приклад використання функцій fseek and ftell.&quot;</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

        <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
        <span class="kt">long</span> <span class="n">length</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;length = %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="n">putchar</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>У прикладі спочатку створюють файл, у який записують рядок <code>"Приклад використання функцій fseek and ftell."</code>. Потім цей файл відкривають на читання, і за допомогою функції <code>fseek(fp, 0L, SEEK_END)</code> указівник позиції переміщують на кінець файлу (за рахунок установлення прапорця <code>SEEK_END</code>). У результаті функція <code>ftell(fp)</code> поверне число символів у відкритому файлі. Далі функція <code>fseek(fp, -i, SEEK_END)</code> у циклі зміщує вказівник позиції на <code>-i</code> символів відносно кінця файлу, після чого функція <code>getc()</code> зчитує символ, який стоїть на <code>i</code>-й позиції з кінця. Оскільки змінна i пробігає значення від 1 до <code>length</code>, на екран буде виведено символи з файлу у зворотному порядку.</p>
<h2 id="&#1056;&#1086;&#1073;&#1086;&#1090;&#1072;-&#1079;-&#1073;&#1110;&#1085;&#1072;&#1088;&#1085;&#1080;&#1084;&#1080;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;">&#1056;&#1086;&#1073;&#1086;&#1090;&#1072; &#1079; &#1073;&#1110;&#1085;&#1072;&#1088;&#1085;&#1080;&#1084;&#1080; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;<a class="anchor-link" href="#&#1056;&#1086;&#1073;&#1086;&#1090;&#1072;-&#1079;-&#1073;&#1110;&#1085;&#1072;&#1088;&#1085;&#1080;&#1084;&#1080;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;"> </a></h2><p>В усіх розглянутих вище прикладах функція <code>fopen()</code> у режимах <code>"r"</code> та <code>"w"</code> відкриває текстовий файл на читання й запис, відповідно. Це означає, що деякі символи форматування тексту, наприклад, повернення каретки <code>'\r'</code>, не можна зчитати як окремі символи: їх ніби не існує у файлі, хоча насправді вони там є.</p>
<p>Для «тоншої» роботи з умістом файлів існує бінарний режим, який подає вміст файлу як послідовність байтів, у якій керуючі коди є просто числами. У цьому режимі можливе видалення та додавання керуючих символів, недоступне в текстовому режимі. Продемонструймо особливості опрацювання бінарного файлу на прикладі підрахунку у файлі числа керуючих символів повернення каретки <code>'\r'</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-87">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.7">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.7<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.7"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;Приклад</span><span class="se">\n</span><span class="s"> із</span><span class="se">\n</span><span class="s"> файлом.&quot;</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">||</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Текстовий файл: кількість = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>

    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;my_file.txt&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\r&#39;</span> <span class="o">||</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
                <span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Бінарний файл: кількість = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Результат роботи програми такий:</p>

<pre><code>Текстовий файл: кількість = 0
Бінарний файл: кількість = 2</code></pre>
<p>Аналіз одержаного результату свідчить, що під час відкриття файлу в текстовому режимі, функція <code>getc()</code> не зчитує символи повернення каретки <code>'\r'</code> а в бінарному режимі всі символи доступні.</p>
<p>Ще однією особливістю текстового формату файлу є запис чисел у вигляді тексту. У попередніх прикладах, коли виконувався запис числа у файл за допомогою функції <code>printf()</code> (наприклад, року видання книжки), то воно замінювалося на рядок. А коли рядок зчитувався за допомогою функції <code>fscanf()</code>, то він перетворювався назад у число.</p>
<p>Для компактного подання інформації у файлі числа доцільно зберігати як числа, а не як рядки. При цьому доречно використовувати бінарний режим доступу до файлу, оскільки в такому випадку будь-яке число буде сприйматиметься не як керуючий символ, а як число, і буде коректно зчитано з файлу.</p>
<p>Для роботи з бінарними файлами передбачено функції <code>fread()</code> і <code>fwrite()</code>. Розгляньмо приклад їх використання.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-88">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.8">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.8<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.8"> </a></h4><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">list</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">numread</span><span class="p">,</span> <span class="n">numwritten</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;fread.out&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">26</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="sc">&#39;z&#39;</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
        <span class="n">numwritten</span> <span class="o">=</span> <span class="n">fwrite</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">26</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Записано %d значень</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numwritten</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;fread.out&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">numread</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">26</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Прочитано %d значень</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numread</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Уміст буфера: %.26s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Помилка під час відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>У прикладі масив <code>list</code> виступає буфером для виведення й уведення інформації з бінарного файлу. Спочатку елементи буфера ініціалізують літерами латинського алфавіту від <code>z</code> до <code>a</code>, а потім записують у файл за допомогою функції <code>fwrite(list, sizeof(char), 26, fp)</code>. Тут оператор <code>sizeof(char)</code> дає розмір елемента (літери), а число 26 відповідає числу записуваних літер. Аналогічним чином здійснюють зчитування інформації з файлу <code>fread(list, sizeof(char), 26, fp)</code>, де в масив list поміщаються 26 символів, які зберігають у файлі.</p>
<p>Функція <code>fopen()</code> під час відкриття файлу на запис знищує всі дані з нього. Щоб відкрити файл для додавання даних, не знищуючи раніше записаної інформації, третім аргументом функції <code>fopen()</code> потрібно задати <code>"a"</code> або <code>"ab"</code>, що означає відкрити файл на додавання інформації в його кінець.</p>
<p>Коли стандартні функції повертають <code>EOF</code>, як правило це означає, що вони досягли кінця файлу. Проте, це також може означати помилку уведення інформації з файлу. Щоб розрізнити ці дві ситуації, у мові С існують функції <code>feof()</code> і <code>ferror()</code>:</p>
<ul>
<li><code>feof()</code> повертає значення, відмінне від 0, якщо досягнуто кінець файлу, і 0 — в іншому випадку;</li>
<li><code>ferror()</code> повертає ненульове значення, якщо сталася помилка читання чи запису, і 0 — в іншому випадку.</li>
</ul>
<h2 id="&#1047;&#1072;&#1075;&#1072;&#1083;&#1100;&#1085;&#1110;-&#1087;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087;&#1080;-&#1088;&#1086;&#1073;&#1086;&#1090;&#1080;-&#1079;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;-&#1079;&#1072;&#1087;&#1080;&#1089;&#1110;&#1074;">&#1047;&#1072;&#1075;&#1072;&#1083;&#1100;&#1085;&#1110; &#1087;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087;&#1080; &#1088;&#1086;&#1073;&#1086;&#1090;&#1080; &#1079; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080; &#1079;&#1072;&#1087;&#1080;&#1089;&#1110;&#1074;<a class="anchor-link" href="#&#1047;&#1072;&#1075;&#1072;&#1083;&#1100;&#1085;&#1110;-&#1087;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087;&#1080;-&#1088;&#1086;&#1073;&#1086;&#1090;&#1080;-&#1079;-&#1092;&#1072;&#1081;&#1083;&#1072;&#1084;&#1080;-&#1079;&#1072;&#1087;&#1080;&#1089;&#1110;&#1074;"> </a></h2><p>Розгляньмо основні принципи роботи з файлами, що містять записи структур деякого типу.</p>
<p>Спочатку потрібно за допомогою відповідної програми створити файл. У програмі повинно бути передбачено функцію додавання запису. Оскільки уведення запису з клавіатури як цілісності неможливо, кожне поле (якщо воно не структуроване) потрібно уводити окремо за запитом або заповнюючи екранну форму. Сформовану структуру записують у файл як цілісність.</p>
<p>Під час читання інформації з файлу читати запис ліпше як цілісність, а потім у програмі аналізувати вміст полів та виконувати потрібні дії.</p>
<p>Для зміни у файлі деякого запису після його прочитання потрібно змістити вказівник файлу на один запис назад, оскільки кожна операція читання-запису зміщує його автоматично. Потім змінені дані можна записувати.
Розгляньмо декілька прикладів роботи з файлами записів.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-89">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.9">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.9<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.9"> </a></h4><p>Скласти програму, яка виконує такі функції:</p>
<ol>
<li>Створення нового файлу структур із такими полями:<ul>
<li>назва товару;</li>
<li>ціна товару;</li>
<li>кількість товару;</li>
<li>перегляд файлу.</li>
</ul>
</li>
<li>Додавання інформації в кінець файлу.</li>
<li>Пошук даних за назвою товару, зміна ціни й кількості.</li>
</ol>
<p>Завдання потрібно виконати в окремих функціях. Для вибору функцій використовувати меню.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">good</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span> <span class="n">t1</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">input</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span> <span class="cm">/*створення нового файлу*/</span>
<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span> <span class="cm">/*перегляд файлу*/</span>
<span class="kt">void</span> <span class="nf">app</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span>   <span class="cm">/*додавання у файл*/</span>
<span class="kt">void</span> <span class="nf">find</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="p">);</span>  <span class="cm">/*пошук та зміна*/</span>

<span class="kt">void</span> <span class="nf">clrscr</span><span class="p">()</span> <span class="p">{</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;clr||clear&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">flush</span><span class="p">()</span>  <span class="p">{</span> <span class="k">while</span><span class="p">(</span><span class="n">getchar</span><span class="p">()</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">clrscr</span><span class="p">();</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;1 – Новий файл&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;2 – Перегляд файлу&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;3 – Додавання у файл&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;4 – Пошук та зміна&quot;</span><span class="p">);</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;0 - Вихід&quot;</span><span class="p">);</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>

        <span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="sc">&#39;1&#39;</span><span class="o">:</span> <span class="n">input</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;2&#39;</span><span class="o">:</span> <span class="n">print</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;3&#39;</span><span class="o">:</span> <span class="n">app</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;4&#39;</span><span class="o">:</span> <span class="n">find</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">&#39;0&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неправильний режим!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">input</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для запису*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Уведення товарів</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">do</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Назва: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Ціна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>

        <span class="cm">/*запис у файл однієї структури t1*/</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Завершити? y/n &quot;</span><span class="p">);</span>

        <span class="n">flush</span><span class="p">();</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">getch</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="sc">&#39;y&#39;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="cm">/*відкриття бінарного файлу для читання*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="cm">/*читання з файлу однієї структури t1*/</span>
    <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%3dНазва %10s Ціна %6.2f Кільк. %4d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">flush</span><span class="p">();</span>
    <span class="n">getchar</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">app</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для додавання*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Уведення товарів</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Назва: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Ціна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Завершити? y/n &quot;</span><span class="p">);</span>
        <span class="n">flush</span><span class="p">();</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">getch</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="sc">&#39;y&#39;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">find</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="n">good</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
    <span class="kt">long</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="cm">/*відкриття бінарного файлу для читання й запису*/</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.dat&quot;</span><span class="p">,</span> <span class="s">&quot;rb+&quot;</span><span class="p">);</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Назва потрібного товару:&quot;</span><span class="p">);</span>
    <span class="n">gets</span><span class="p">(</span><span class="n">good</span><span class="p">);</span>
    <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Назва %10s Ціна %6.2f Кільк. %d&quot;</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Змінити? y/n &quot;</span><span class="p">);</span>

            <span class="n">flush</span><span class="p">();</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Кількість: &quot;</span><span class="p">);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Ціна: &quot;</span><span class="p">);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
                <span class="n">i</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">);</span>
                <span class="cm">/*повернення на sizeof(t1) байтів назад*/</span>
                <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="cm">/*запис зміненої структури на колишнє місце*/</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-810">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.10">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.10<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.10"> </a></h4><p>Програма для корекції існуючого файлу з результатами деякої олімпіади. Відповідна структура містить:</p>
<ul>
<li>поле для назви країни;</li>
<li>масив із 3 чисел для медалей різного ґатунку.</li>
</ul>
<p>У програмі спочатку визначають кількість записів у файлі за допомогою оригінальної функції та виводять результати у вигляді таблиці. Потім користувач може увести назву країни та відкоригувати дані. Якщо такої країни у файлі не знайдено, її додають у кінець файлу. Якщо користувач уведе замість назви країни мінус, процес корекції закінчується.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">clrscr</span><span class="p">()</span> <span class="p">{</span> <span class="n">system</span><span class="p">(</span><span class="s">&quot;clr||clear&quot;</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">medal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Gold&quot;</span><span class="p">,</span> <span class="s">&quot;Silver&quot;</span><span class="p">,</span> <span class="s">&quot;Bronze&quot;</span><span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">sport</span><span class="p">;</span>

<span class="kt">long</span> <span class="nf">frecount</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">fn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*визначення числа записів*/</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">clrscr</span><span class="p">();</span>
    <span class="n">sport</span> <span class="n">s</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">mdf</span><span class="p">,</span> <span class="n">country</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mf</span><span class="p">;</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">r</span><span class="p">,</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">frecount</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sport</span><span class="p">));</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Кількість записів у файлі: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nr</span><span class="p">);</span>

    <span class="cm">/*виведення записів у вигляді таблиці*/</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна Золото Срібло Бронза</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="cm">/*корекція й додавання записів*/</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ol.dat&quot;</span><span class="p">,</span> <span class="s">&quot;r+b&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Неможливо відкрити файл!&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="cm">/*нескінченний цикл корекції*/</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна: &quot;</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%15s&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">country</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span> <span class="cm">/*вихід із циклу корекції*/</span> 
        <span class="n">rewind</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
            <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>

        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
            <span class="cm">/*цикл пошуку країни у файлі*/</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Нові дані:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">medal</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                    <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">fflush</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">rewind</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="kt">long</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*нова країна – додавання*/</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Країна: &quot;</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%-15s&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
            <span class="n">strcpy</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">country</span><span class="p">);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Медалі:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">medal</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="n">s</span><span class="p">.</span><span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0L</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">getchar</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">getch</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Запустити цей код можна за <a href="https://repl.it/@GasperPaul/Lab8-Example-811">посиланням</a>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.11">&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076; 8.11<a class="anchor-link" href="#&#1055;&#1088;&#1080;&#1082;&#1083;&#1072;&#1076;-8.11"> </a></h4><p>Програма для організації запису рядка (символьного масиву) у файл блоком, а також читання й виведення на екран записаної інформації.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span><span class="o">*</span> <span class="n">fp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">msg</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;це тест&quot;</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;DUMMY.FIL&quot;</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Помилка відкриття файлу!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/*запис рядка у файл*/</span> 
    <span class="n">fwrite</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="cm">/*установка вказівника на початок файлу*/</span>
    <span class="n">fseek</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">);</span>
    <span class="cm">/*читання рядка з файлу*/</span>
    <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>У цій програмі потік відкривають у режимі <code>"w+"</code> (створення для запису з послідовним читанням). Тому закривати файл під час запису не було потрібно.</p>
<p>У мові С також існують функції <code>remove()</code> і <code>rename()</code> для видалення й перейменування файлів, відповідно. Їхній синтаксис такий:</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">path</span><span class="p">);</span>
</pre></div>
<p>де <code>*path</code> — шлях з іменем файлу, який видаляють.</p>
<p>Цю функцію визначено в бібліотеці <code>stdio.h</code>, вона повертає 0 за успішного видалення та -1 — у протилежному випадку;</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">rename</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">oldn</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">newn</span><span class="p">);</span>
</pre></div>
<p>де</p>
<ul>
<li><code>*oldn</code> — ім’я файлу для перейменування;</li>
<li><code>*newn</code> — нове ім’я файлу.</li>
</ul>
<p>Цю функцію визначено в бібліотеці <code>stdio.h</code>, вона повертає 0 за успішного перейменування, та ненульове значення — у протилежному випадку.</p>

</div>
</div>
</div>
</div>

 


    </main>
    